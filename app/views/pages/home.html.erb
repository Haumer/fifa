<%= render "shared/banner" %>
<div class="background_wrapper">
  <div class="container">
    <div class="row">
      <div class="hype col-xs-12 col-sm-6 col-sm-offset-3">
        <div  class="hype_message">
          <% @matches_order = Match.all.order(:cached_votes_score => :desc) %>
          <span><%= @matches_order.first.get_upvotes.size %> People are hyped for:</span>
          <span>
          <%= @matches_order.first.home_name %> vs <%= @matches_order.first.away_name %>
          </span>
        </div>
        <div class="hype_vote">
         <%= link_to "Upvote your favourite match now!", hype_matches_path %>
        </div>
      </div>
    </div>
    <div class="row">
      <h2>Group Standings</h2>
      <% @groups.each do |group| %>
        <div class="group col-xs-12 col-sm-6 col-lg-3">
          <%= link_to group_path(group) do %>
            <div class="group-header">
              <h4><%= group.name %></h4>
            </div>
          <% end %>
          <table class="home_groups">
            <tr>
              <th class="flag"></th>
              <th id="first_head">Country</th>
              <th class="data_head">W</th>
              <th class="data_head">D</th>
              <th class="data_head">L</th>
              <th class="data_head">Pts</th>
            </tr>
            <% group.teams.each do |team| %>
            <tr class="home_groups_row">
              <td class="flag_data">
                <%= link_to team_path(team.id) do %>
                  <img src="<%= team.photo %>" alt="">
                <% end %>
              </td>
              <td id="first_value">
                <%= link_to team_path(team.id) do %>
                  <% if team.name == "Morroco" %>
                    Morocco
                  <% else %>
                    <%= team.name %>
                  <% end %>
                <% end %>
              </td>
              <td class="data_value"><%= team.wins %></td>
              <td class="data_value"><%= team.draws %></td>
              <td class="data_value"><%= team.losses %></td>
              <td class="data_value"><%= team.points %></td>
            </tr>
            <% end %>
          </table>
          <div class="next_match">
          <% sorted = group.matches.sort_by {|k, _v| k.date} %>
          <% array = [] %>
          <% sorted.each_with_index do |match_unit, index| %>
            <% if match_unit.date > DateTime.now.advance(:hours => +2) %>
              <% array << index %>
            <% end %>
          <% end %>
            <% if sorted[array.sort.first].date < DateTime.now %>
              <span>Next Match: <%= sorted[array.sort.first].home_name %> vs <%= sorted[array.sort.first].away_name %></span>
              <br>
              <span>Currently LIVE </span>
              <span class="countdown"></span>
            <% else %>
              <span>Next Match: <%= sorted[array.sort.first].home_name %> vs <%= sorted[array.sort.first].away_name %></span>
              <br>
              <span>In: </span>
              <span class="countdown"><%= sorted[array.sort.first].date %></span>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
    <div class="row">
      <h2>Group Matches</h2>
      <% @groups.each do |group| %>
      <% sorted_matches = group.matches.sort_by { |k| k["date"]} %>
      <div class="group col-xs-12 col-sm-3">
        <div class="match-header">
          <table class="home_matches">
            <tr>
              <th id="match_first_head"><%= group.name %></th>
              <th class="match_data_head"></th>
              <th id="match_last_head">Matches</th>
            </tr>
          <% sorted_matches.each do |match_data| %>
          <tr class="home_match_row">
            <td id="match_first_value"><%= match_data.home_name %></td>
            <td class="match_data_value"><%= link_to " vs ", match_path(match_data.id)%></td>
            <td id="match_last_value"><%= match_data.away_name %></td>
          </tr>
          <% end %>
        </table>
        </div>
      </div>
      <% end %>
    </div>
  </div>
</div>
